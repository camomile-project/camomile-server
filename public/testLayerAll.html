<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Get a json file from the server, parse it and post to mongodb</title>
</head>
<body>
    <div id="placeholder"></div>
    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script>
    	$(function(){
    		$('#select_link').click(function(e){
                e.preventDefault();
                console.log('select_link clicked');
     			
     			//$.getJSON('http://localhost:3001/getFileJson/BFMTV_BFMStory_2011-07-11_175900-Speaker.json', function(data) {
				var jsonAnno = [];
				$.ajax({
					url: 'BFMTV_BFMStory_2011-07-11_175900-Speaker.json',
					type: 'get',
					dataType: 'json',
					error: function(data){
							console.log('error');
					},
					success: function(data){
					  	console.log('data'); 	console.log(data);
					//}
				//});
		
		
						//$.getJSON('../data/BFMTV_BFMStory_2011-07-11_175900-Speaker.json', function(data) {
						// var jsonAnno = [];
						for (var i in data.annotation) {
							var itemAnno = {
								"fragment" : {
									"start" : data.annotation[i].segment.start,
									"end" : data.annotation[i].segment.end
								},
								"data" : data.annotation[i].label
							}
							jsonAnno.push(itemAnno);
							//console.log(data.annotation[i]); break;
						}
		
						console.log(jsonAnno);
		
						var anno = {
							//"id_media" : "51d33f532d769e5803000002",
							"id_media" : "51f25491c021410802000003",
							"layer_type" : "speaker-ground truth",
							"fragment_type" : "segment",
							"data_type" : "label",
							"source" : {"uri" :"BFMTV_BFMStory_2011-07-11_175900.trs", "creator" : "ELDA"},
							"annotation" : jsonAnno,
							"history" : {"name" : "ELDA", "date": new Date()}
						};//*/
						$.ajax({
							type: 'POST',
							data: JSON.stringify(anno),
							contentType: 'application/json',
							//url: 'http://localhost:3001/corpus/media/layer/post',						
							url: 'http://localhost:3000/corpus/1111/media/51f25491c021410802000003/layerAll',
							success: function(data) {
								console.log('success');
								console.log(JSON.stringify(data));
							}
						});
						//console.log("annotation");
					//console.log(anno);//*/
							//output+="</ul>";
					//document.getElementById("placeholder").innerHTML=output;
					}
		  		});
     			           
            });				
        });
    </script>
    
    
    <script>
    	$(function(){
    		$('#select_link_spoken').click(function(e){
                e.preventDefault();
                console.log('select_link clicked');
     			
     			//$.getJSON('http://localhost:3001/getFileJson/BFMTV_BFMStory_2011-07-11_175900-Speaker.json', function(data) {
				var jsonAnno = [];
				$.ajax({
					url: 'BFMTV_BFMStory_2011-07-11_175900-Spoken.json',
					type: 'get',
					dataType: 'json',
					error: function(data){
						console.log('error in getting file BFMTV_BFMStory_2011-07-11_175900-Spoken.json');
					},
					success: function(data){
					  	console.log('data'); 	console.log(data);
					
						for (var i in data.annotation) {
							var itemAnno = {
								"fragment" : {
									"start" : data.annotation[i].segment.start,
									"end" : data.annotation[i].segment.end
								},
								"data" : data.annotation[i].label
							}
							jsonAnno.push(itemAnno);
							//console.log(data.annotation[i]); break;
						}
		
						console.log(jsonAnno);
		
						var anno = {
							//"id_media" : "51d33f532d769e5803000002",
							"id_media" : "51f25491c021410802000003",
							"layer_type" : "spoken-ground truth",
							"fragment_type" : "segment",
							"data_type" : "label",
							"source" : {"uri" :"BFMTV_BFMStory_2011-07-11_175900.trs", "creator" : "ELDA"},
							"annotation" : jsonAnno,
							"history" : {"name" : "ELDA", "date" : new Date()}
						};//*/
						$.ajax({
							type: 'POST',
							data: JSON.stringify(anno),
							contentType: 'application/json',
							url: 'http://localhost:3000/corpus/1111/media/51f25491c021410802000003/layerAll',
							//url: 'http://localhost:3001/corpus/media/layer/post',						
							success: function(data) {
								console.log('success');
								console.log(JSON.stringify(data));
							}
						});
					}
		  		});
     			           
            });				
        });
    </script>
    
     <script>
    	$(function(){
    		$('#select_link_spokenUpdate').click(function(e){
                e.preventDefault();
                console.log('select_link clicked');
                
                var anno = {
//							"id_media" : "51d33f532d769e5803000002",
							"id_media" : "51d348f283851e7403000002",
							"layer_type" : "spoken-ground truthA",
							"fragment_type" : "segmentA",
							"data_type" : "label",
							"source" : {"uri" :"BFMTV_BFMStory_2011-07-11_175900.trs", "creator" : "ELDA"},
							"history" : {"name" : "LIMSI", "date" : "12/07/2013"}
						};//*/
						$.ajax({
							type: 'PUT',
							data: JSON.stringify(anno),
							contentType: 'application/json',
							url: 'http://localhost:3000/corpus/51cd83579474ece703000002/media/51d348f283851e7403000002/layer/51d5e04eb4b3742802000001',
							//url: 'http://localhost:3001/corpus/media/layer/post',						
							success: function(data) {
								console.log('success');
								console.log(JSON.stringify(data));
							}
						});
    		});				
        });
    </script>
    
    <script type="text/javascript">
            $(function(){				
                $('#select_delete').click(function(e){
                    e.preventDefault();
                    console.log('select_link clicked');
                    //http://localhost:3000/corpus/51cd83579474ece703000002/media/51d33f532d769e5803000002/
                    //layer/51dffeb21525d59104000001/annotation
					
					$.ajax({
						type: 'DELETE',
						data : JSON.stringify({"id_layer":"51eeef32331c627d0100004f"}),
				        contentType: 'application/json',
                        //url: 'http://localhost:3001/corpusA/51cd866853b6d8fc03000002',						
                        url: 'http://localhost:3000/corpus/51cd83579474ece703000002/media/51d33f532d769e5803000002/layer/51eeef32331c627d0100004f',						
                        success: function(data) {
                            console.log('success: already deleted!!! SORRRRY');
                            console.log(JSON.stringify(data));
                        }
                    });
                });				
            });
        </script>
    <div id="select_div"><a href="#" id="select_link">Click here to upload a layer (type of speakers) with a list of annotations</a></div>
    
    <div id="select_div_spoken"><a href="#" id="select_link_spoken">Click here to upload a layer (type of spokens) with a list of annotations</a></div>        
    
    <div id="select_div_spokenUpdate"><a href="#" id="select_link_spokenUpdate">Click here to update an existing layer (type of spokens)</a></div>
    <div id="select_div_delete"><a href="#" id="select_delete">Click here to delete an existing layer</a></div>                
</body>
</html>